#!/usr/bin/env node
"use strict";

var fs = require("fs");
var path = require("path");
var amf = require("..");

function usage() {
    console.error("Usage: amf-inspect <file.amf> [--amf0|--amf3]");
    process.exit(1);
}

var argv = process.argv.slice(2);
if (argv.length < 1) usage();

var file = path.resolve(process.cwd(), argv[0]);
var mode = argv.indexOf("--amf3") !== -1 ? 3 : (argv.indexOf("--amf0") !== -1 ? 0 : undefined);

var buf = fs.readFileSync(file);
var opts = {};
if (mode === 0 || mode === 3) opts.objectEncoding = mode;

var data = amf.decode(buf, opts);

function replacer(key, value) {
    if (Buffer.isBuffer(value)) return { type: "ByteArray", length: value.length };
    return value;
}

console.log(JSON.stringify(data, replacer, 2));


